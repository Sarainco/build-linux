From 32db2bc5d41f3633144a3533650bd37c4891c982 Mon Sep 17 00:00:00 2001
From: yuji <yujibuzailai_sun@outlook.com>
Date: Tue, 10 Jun 2025 09:38:48 +0800
Subject: [PATCH] feat:i2c-gpio and add opt3001 driver

---
 .../boot/dts/rockchip/rk3568-atk-atompi-ca1.dts    | 14 ++++++++++++++
 arch/arm64/configs/rockchip_linux_defconfig        |  2 ++
 2 files changed, 16 insertions(+)

diff --git a/arch/arm64/boot/dts/rockchip/rk3568-atk-atompi-ca1.dts b/arch/arm64/boot/dts/rockchip/rk3568-atk-atompi-ca1.dts
index bb265c21a..60fa9b68e 100644
--- a/arch/arm64/boot/dts/rockchip/rk3568-atk-atompi-ca1.dts
+++ b/arch/arm64/boot/dts/rockchip/rk3568-atk-atompi-ca1.dts
@@ -195,6 +195,20 @@
 		//amp-supply = <&beeper_amp>;
 	};
 
+	i2c-gpio0 {
+		compatible = "i2c-gpio";
+		sda-gpios = <&gpio4 RK_PA1 GPIO_ACTIVE_HIGH>;
+		scl-gpios = <&gpio3 RK_PD1 GPIO_ACTIVE_HIGH>;
+		i2c-gpio,delay-us = <2>;	/* ~100 kHz */
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		opt3001: opt3001@44 {
+			compatible = "ti,opt3001";
+			reg = <0x44>;
+		};
+	};
+
 };
 
 &pwm3 {
diff --git a/arch/arm64/configs/rockchip_linux_defconfig b/arch/arm64/configs/rockchip_linux_defconfig
index ad2b3d5fd..27cf0186d 100644
--- a/arch/arm64/configs/rockchip_linux_defconfig
+++ b/arch/arm64/configs/rockchip_linux_defconfig
@@ -239,6 +239,7 @@ CONFIG_HW_RANDOM_ROCKCHIP=y
 CONFIG_TCG_TPM=y
 CONFIG_TCG_TIS_I2C_INFINEON=y
 CONFIG_I2C_CHARDEV=y
+CONFIG_I2C_GPIO=y
 CONFIG_I2C_RK3X=y
 CONFIG_I2C_CROS_EC_TUNNEL=y
 CONFIG_SPI=y
@@ -494,6 +495,7 @@ CONFIG_IIO_TRIGGER=y
 CONFIG_ROCKCHIP_SARADC=y
 CONFIG_INV_ICM42600_I2C=y
 CONFIG_SENSORS_ISL29018=y
+CONFIG_OPT3001=y
 CONFIG_SENSORS_TSL2563=y
 CONFIG_TSL2583=y
 CONFIG_IIO_SYSFS_TRIGGER=y
-- 
2.25.1

